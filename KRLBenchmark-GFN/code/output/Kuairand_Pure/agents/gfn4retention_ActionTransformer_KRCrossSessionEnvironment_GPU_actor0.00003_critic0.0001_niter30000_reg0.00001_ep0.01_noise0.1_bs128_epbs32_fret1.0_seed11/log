Namespace(agent_class='GFN4Retention', buffer_class='CrossSessionBuffer', critic1_class='VCritic', critic2_class='BCritic', env_class='KRCrossSessionEnvironment_GPU', policy_class='ActionTransformer')
device: cpu
Loading environment
Environment arguments: 
Namespace(attn_n_head=4, batch_size=128, cuda=0, data_separator=',', dropout_rate=0.1, enc_dim=64, epoch=10, item_latent_dim=32, item_meta_file='dataset/Kuairand_Pure/video_features_basic_Pure_fillna.csv', l2_coef=0.0, loss='bce', lr=0.0001, max_hist_seq_len=100, meta_file_sep=',', model_path='output/Kuairand_Pure/env/user_KRMBUserResponse_lr0.0001_reg0_nlayer2.model', n_worker=4, save_with_val=False, scorer_hidden_dims=[128, 32], seed=619607, state_hidden_dims=[128], test_batch_size=128, test_file='', test_holdout_per_user=5, train_file='dataset/Kuairand_Pure/log_session_4_08_to_5_08_Pure.csv', transformer_d_forward=64, transformer_n_layer=2, user_latent_dim=32, user_meta_file='dataset/Kuairand_Pure/user_features_Pure_fillna.csv', val_batch_size=128, val_file='', val_holdout_per_user=5)
Loading raw data
Load user sequence reader
initiate KuaiRandMultiBehaior sequence reader
Loading data files
Load item meta data
Load user meta data
build vocab for onehot features
build vocab for onehot features
build vocab for multihot features:
	tag
sequence holdout for users (-1, 0, 0)
{'raw_data_size': 1341250, 'data_size': [1341250, 0, 0], 'n_user': 19574, 'n_item': 5659, 'max_seq_len': 100, 'user_features': ['user_active_degree', 'is_live_streamer', 'is_video_author', 'follow_user_num_range', 'fans_user_num_range', 'friend_user_num_range', 'register_days_range', 'onehot_feat0', 'onehot_feat1', 'onehot_feat6', 'onehot_feat9', 'onehot_feat10', 'onehot_feat11'], 'user_feature_dims': {'user_active_degree': 9, 'is_live_streamer': 2, 'is_video_author': 2, 'follow_user_num_range': 8, 'fans_user_num_range': 9, 'friend_user_num_range': 7, 'register_days_range': 8, 'onehot_feat0': 2, 'onehot_feat1': 7, 'onehot_feat6': 3, 'onehot_feat9': 7, 'onehot_feat10': 5, 'onehot_feat11': 5}, 'item_features': ['video_type', 'music_type', 'upload_type', 'tag'], 'item_feature_dims': {'video_type': 3, 'music_type': 6, 'upload_type': 14, 'tag': 47}, 'feedback_type': ['is_click', 'long_view', 'is_like', 'is_comment', 'is_forward', 'is_follow', 'is_hate'], 'feedback_size': 7, 'feedback_negative_sample_rate': {'is_click': 0.8464776846374433, 'long_view': 0.4917230917066313, 'is_like': 0.01871086080593036, 'is_comment': 0.0025916011789654976, 'is_forward': 0.0009298479706030729, 'is_follow': 0.000979149781557057, 'is_hate': -0.0004945594728279478}}
Load immediate user response model
Load (checkpoint) from output/Kuairand_Pure/env/user_KRMBUserResponse_lr0.0001_reg0_nlayer2.model.checkpoint
{'raw_data_size': 1341250, 'data_size': [1124729, 89160, 89160], 'n_user': 19574, 'n_item': 5659, 'max_seq_len': 100, 'user_features': ['user_active_degree', 'is_live_streamer', 'is_video_author', 'follow_user_num_range', 'fans_user_num_range', 'friend_user_num_range', 'register_days_range', 'onehot_feat0', 'onehot_feat1', 'onehot_feat6', 'onehot_feat9', 'onehot_feat10', 'onehot_feat11'], 'user_feature_dims': {'user_active_degree': 9, 'is_live_streamer': 2, 'is_video_author': 2, 'follow_user_num_range': 8, 'fans_user_num_range': 9, 'friend_user_num_range': 7, 'register_days_range': 8, 'onehot_feat0': 2, 'onehot_feat1': 7, 'onehot_feat6': 3, 'onehot_feat9': 7, 'onehot_feat10': 5, 'onehot_feat11': 5}, 'item_features': ['video_type', 'music_type', 'upload_type', 'tag'], 'item_feature_dims': {'video_type': 3, 'music_type': 6, 'upload_type': 14, 'tag': 47}, 'feedback_type': ['is_click', 'long_view', 'is_like', 'is_comment', 'is_forward', 'is_follow', 'is_hate'], 'feedback_size': 7, 'feedback_negative_sample_rate': {'is_click': 0.8464776846374433, 'long_view': 0.4917230917066313, 'is_like': 0.01871086080593036, 'is_comment': 0.0025916011789654976, 'is_forward': 0.0009298479706030729, 'is_follow': 0.000979149781557057, 'is_hate': -0.0004945594728279478}}
Setup candidate item pool
Setup policy:
ActionTransformer(
  (uIDEmb): Embedding(19575, 16)
  (UFEmb_user_active_degree): Linear(in_features=9, out_features=16, bias=True)
  (UFEmb_is_live_streamer): Linear(in_features=2, out_features=16, bias=True)
  (UFEmb_is_video_author): Linear(in_features=2, out_features=16, bias=True)
  (UFEmb_follow_user_num_range): Linear(in_features=8, out_features=16, bias=True)
  (UFEmb_fans_user_num_range): Linear(in_features=9, out_features=16, bias=True)
  (UFEmb_friend_user_num_range): Linear(in_features=7, out_features=16, bias=True)
  (UFEmb_register_days_range): Linear(in_features=8, out_features=16, bias=True)
  (UFEmb_onehot_feat0): Linear(in_features=2, out_features=16, bias=True)
  (UFEmb_onehot_feat1): Linear(in_features=7, out_features=16, bias=True)
  (UFEmb_onehot_feat6): Linear(in_features=3, out_features=16, bias=True)
  (UFEmb_onehot_feat9): Linear(in_features=7, out_features=16, bias=True)
  (UFEmb_onehot_feat10): Linear(in_features=5, out_features=16, bias=True)
  (UFEmb_onehot_feat11): Linear(in_features=5, out_features=16, bias=True)
  (iIDEmb): Embedding(5660, 16)
  (IFEmb_video_type): Linear(in_features=3, out_features=16, bias=True)
  (IFEmb_music_type): Linear(in_features=6, out_features=16, bias=True)
  (IFEmb_upload_type): Linear(in_features=14, out_features=16, bias=True)
  (IFEmb_tag): Linear(in_features=47, out_features=16, bias=True)
  (feedbackEncoder): Linear(in_features=7, out_features=32, bias=True)
  (itemEmbNorm): LayerNorm((16,), eps=1e-05, elementwise_affine=True)
  (userEmbNorm): LayerNorm((16,), eps=1e-05, elementwise_affine=True)
  (itemFeatureKernel): Linear(in_features=16, out_features=32, bias=True)
  (userFeatureKernel): Linear(in_features=16, out_features=32, bias=True)
  (encDropout): Dropout(p=0.1, inplace=False)
  (encNorm): LayerNorm((32,), eps=1e-05, elementwise_affine=True)
  (posEmb): Embedding(100, 32)
  (transformer): TransformerEncoder(
    (layers): ModuleList(
      (0-1): 2 x TransformerEncoderLayer(
        (self_attn): MultiheadAttention(
          (out_proj): NonDynamicallyQuantizableLinear(in_features=64, out_features=64, bias=True)
        )
        (linear1): Linear(in_features=64, out_features=64, bias=True)
        (dropout): Dropout(p=0.1, inplace=False)
        (linear2): Linear(in_features=64, out_features=64, bias=True)
        (norm1): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
        (norm2): LayerNorm((64,), eps=1e-05, elementwise_affine=True)
        (dropout1): Dropout(p=0.1, inplace=False)
        (dropout2): Dropout(p=0.1, inplace=False)
      )
    )
  )
  (stateNorm): LayerNorm((32,), eps=1e-05, elementwise_affine=True)
  (actionModule): DNN(
    (layers): Sequential(
      (0): Linear(in_features=96, out_features=128, bias=True)
      (1): ReLU()
      (2): Dropout(p=0.1, inplace=False)
      (3): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
      (4): Linear(in_features=128, out_features=7, bias=True)
    )
  )
  (sigmoid): Sigmoid()
  (bce_loss): BCEWithLogitsLoss()
)
Setup critic:
VCritic(
  (net): DNN(
    (layers): Sequential(
      (0): Linear(in_features=96, out_features=128, bias=True)
      (1): ReLU()
      (2): Dropout(p=0.1, inplace=False)
      (3): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
      (4): Linear(in_features=128, out_features=1, bias=True)
    )
  )
)
Setup buffer:
<model.buffer.CrossSessionBuffer.CrossSessionBuffer object at 0x7fa8676eb220>
Setup agent:
<model.agent.GFN4Retention.GFN4Retention object at 0x7fa8676ee280>
Namespace(actor_decay=1e-05, actor_lr=3e-05, batch_size=128, buffer_size=100000, check_episode=10, critic1_dropout_rate=0.1, critic1_hidden_dims=[128], critic2_dropout_rate=0.1, critic2_hidden_dims=[32], critic_decay=1e-05, critic_lr=0.0001, cuda=0, device='cpu', do_explore_in_train=False, elbow_epsilon=0.1, episode_batch_size=32, explore_rate=1.0, feedback_influence_on_return=1.0, final_epsilon=0.01, gamma=0.9, gfn_Z=0.0, gfn_backward_offset=1.0, gfn_flow_hidden_dims=[128], gfn_forward_hidden_dims=[128], gfn_forward_offset=1.0, gfn_reward_smooth=1.0, initial_epsilon=0.01, initial_temper=5.0, item_correlation=0.2, l2_coef=0.0, lambda_gfn=0.5, loss='bce', max_n_session=6, max_return_day=10, max_step_per_episode=5, model_path='', n_iter=[30000], next_day_return_bias=0.4, noise_clip=1.0, noise_std=0.1, policy_attn_n_head=4, policy_dropout_rate=0.1, policy_enc_dim=32, policy_hidden_dims=[128], policy_item_latent_dim=16, policy_transformer_d_forward=64, policy_transformer_n_layer=2, policy_user_latent_dim=16, reward_func='get_retention_reward', save_episode=200, save_path='output/Kuairand_Pure/agents/gfn4retention_ActionTransformer_KRCrossSessionEnvironment_GPU_actor0.00003_critic0.0001_niter30000_reg0.00001_ep0.01_noise0.1_bs128_epbs32_fret1.0_seed11/model', seed=11, single_response=False, slate_size=6, start_policy_train_at_step=100, target_mitigate_coef=0.01, tn_balance=0.5, train_every_n_step=1, uirm_log_path='output/Kuairand_Pure/env/log/user_KRMBUserResponse_lr0.0001_reg0_nlayer2.model.log')
Run procedures before training
Early stop manually
Exit completely without evaluation? (y/n) (default n):